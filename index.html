<!doctype html>
<html>
	<head>
		<title>Embedding Vega-Lite</title>
		<script src="https://cdn.jsdelivr.net/npm/vega@5.29.0"></script>
		<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.19.0"></script>
		<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.25.0"></script>
	</head>
	<body>
		<div id="ipc_t"></div>
		<div id="ipc_scat1"></div>
		<div id="ipc_scat2"></div>
		<div id="ipc_scat3"></div>
		<div id="ipc_histo"></div>
		<div id="ipc_box"></div>

		<script type="text/javascript">
			var IPC_Time = {
				"title": "IPC Over Time",
				"width": 10000,
				"height": 80,
				"data": {
					"url":"data/small_data.json"
				},
				"mark": "line",
				"transform": [
					{"calculate": "datum.Inst / datum.Cyc", "as": "IPC"},
					{"filter": "datum.IPC < 5"},
		{"filter": "datum.Cyc < 16000000000000000000"}
				],
				"encoding": {
					"x": {"field": "t", "type": "temporal"},
					"y": {"field": "IPC", "type": "quantitative"},
					"color": {"field": "CPU", "type": "nominal"},
					"row": {"field": "Symbol"}
				}
			}
var Inst_Cyc_Scatter1 = {

	"title": "IPC of different Kernel Functions",
	"width": 400,
	"height": 400,
	"data": {
		"url":"data/small_data.json"
	},
	"transform": [
		{"calculate": "datum.Inst / datum.Cyc", "as": "IPC"},
		{"filter": "datum.IPC < 5"},
		{"filter":"datum.Symbol == 'net_rx_action'"},
		{"filter": "datum.Cyc < 16000000000000000000"},
		{"extent": "Cyc", "param": "MaxCyc"},
    	{"extent": "Inst", "param": "MaxInst"}
	],
	"layer":[
		{
			"mark": "point",
			"transform": [
				{"calculate": "datum.Inst / datum.Cyc", "as": "IPC"},
				{"filter": "datum.IPC < 5"},

				{
					"filter":"datum.Symbol == 'net_rx_action'"
				},
				{"filter": "datum.Cyc < 16000000000000000000"}
			],
			"encoding": {
				"x": {"field": "Cyc", "type": "quantitative"},
				"y": {"field": "Inst", "type": "quantitative"},
				"color": {"field": "CPU", "type": "nominal"},
				"shape": {"field": "CPU", "type": "nominal"},
				"row": {"field": "Symbol"}
			}
		},

		{
			"mark": {"type": "rule", "strokeDash": [3, 1]},
			"encoding": {

				"x": {"value": {"expr": "scale('x', 0)"}},
				"y": {"value": {"expr": "scale('y', 0)"}},
				"x2": {"value": {"expr": "scale('x', (MaxCyc[1] > MaxInst[1]) ? MaxInst[1] : MaxCyc[1])"}},
				"y2": {"value": {"expr": "scale('y', (MaxCyc[1] > MaxInst[1]) ? MaxInst[1] : MaxCyc[1])"}}
			}
		}
	]

}
var Inst_Cyc_Scatter2 = {

	"title": "IPC of different Kernel Functions",
	"width": 400,
	"height": 400,
	"data": {
		"url":"data/small_data.json"
	},
	"transform": [
		{"calculate": "datum.Inst / datum.Cyc", "as": "IPC"},
		{"filter": "datum.IPC < 5"},
		{"filter":"datum.Symbol == 'napi_gro_receive'"},
		{"filter": "datum.Cyc < 16000000000000000000"},
		{"extent": "Cyc", "param": "MaxCyc"},
    	{"extent": "Inst", "param": "MaxInst"}
	],
	"layer":[
		{
			"mark": "point",
			"transform": [
				{"calculate": "datum.Inst / datum.Cyc", "as": "IPC"},
				{"filter": "datum.IPC < 5"},

				{
					"filter":"datum.Symbol == 'napi_gro_receive'"
				},
				{"filter": "datum.Cyc < 16000000000000000000"}
			],
			"encoding": {
				"x": {"field": "Cyc", "type": "quantitative"},
				"y": {"field": "Inst", "type": "quantitative"},
				"color": {"field": "CPU", "type": "nominal"},
				"shape": {"field": "CPU", "type": "nominal"},
				"row": {"field": "Symbol"}
			}
		},

		{
			"mark": {"type": "rule", "strokeDash": [3, 1]},
			"encoding": {

				"x": {"value": {"expr": "scale('x', 0)"}},
				"y": {"value": {"expr": "scale('y', 0)"}},
				"x2": {"value": {"expr": "scale('x', (MaxCyc[1] > MaxInst[1]) ? MaxInst[1] : MaxCyc[1])"}},
				"y2": {"value": {"expr": "scale('y', (MaxCyc[1] > MaxInst[1]) ? MaxInst[1] : MaxCyc[1])"}}
			}
		}
	]

}
var Inst_Cyc_Scatter3 = {

	"title": "IPC of different Kernel Functions",
	"width": 400,
	"height": 400,
	"data": {
		"url":"data/small_data.json"
	},
	"transform": [
		{"calculate": "datum.Inst / datum.Cyc", "as": "IPC"},
		{"filter": "datum.IPC < 5"},
		{"filter":"datum.Symbol == '__netif_receive_skb_core'"},
		{"filter": "datum.Cyc < 16000000000000000000"},
		{"extent": "Cyc", "param": "MaxCyc"},
    	{"extent": "Inst", "param": "MaxInst"}
	],
	"layer":[
		{
			"mark": "point",
			"transform": [
			],
			"encoding": {
				"x": {"field": "Cyc", "type": "quantitative"},
				"y": {"field": "Inst", "type": "quantitative"},
				"color": {"field": "CPU", "type": "nominal"},
				"shape": {"field": "CPU", "type": "nominal"},
				"row": {"field": "Symbol"}
			}
		},

		{
			"mark": {"type": "rule", "strokeDash": [3, 1]},
			"encoding": {

				"x": {"value": {"expr": "scale('x', 0)"}},
				"y": {"value": {"expr": "scale('y', 0)"}},
				"x2": {"value": {"expr": "scale('x', (MaxCyc[1] > MaxInst[1]) ? MaxInst[1] : MaxCyc[1])"}},
				"y2": {"value": {"expr": "scale('y', (MaxCyc[1] > MaxInst[1]) ? MaxInst[1] : MaxCyc[1])"}}
			}
		}
	]

}

var IPC_Histo = {
		"title":"Entry Counts",	
		"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
			"data": {"url": "data/small_data.json"},
			"mark": "bar",
	"transform": [
		{"calculate": "datum.Inst / datum.Cyc", "as": "IPC"},
		{"filter": "datum.IPC < 5"},
		{"filter": "datum.Cyc < 16000000000000000000"}
	],
			"encoding": {
				"x": {
					"field": "CPU"
				},
				"y": {"aggregate": "count"},
				"column":{"field":"Symbol"},
				"color":{"field":"CPU"}
			}
	
}

var IPC_Box =
	{
		"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
		"description": "A vertical box plot showing median, min, and max body mass of penguins.",
		"data": {"url": "data/small_data.json"},
		"mark": {
			"type": "boxplot",
			"extent": "min-max"
		},
	"transform": [
		{"calculate": "datum.Inst / datum.Cyc", "as": "IPC"},
		{"filter": "datum.IPC < 5"},
		{"filter": "datum.Cyc < 16000000000000000000"}
	],
		"encoding": {
			"x": {"field": "CPU", "type": "nominal"},
			"color": {"field": "CPU", "type": "nominal", "legend": null},
			"y": {
				"field": "IPC",
				"type": "quantitative",
			},
			"column":{"field":"Symbol"}
		}
	}



vegaEmbed('#ipc_t', IPC_Time);
vegaEmbed('#ipc_scat1', Inst_Cyc_Scatter1);
vegaEmbed('#ipc_scat2', Inst_Cyc_Scatter2);
vegaEmbed('#ipc_scat3', Inst_Cyc_Scatter3);
vegaEmbed('#ipc_histo', IPC_Histo);
vegaEmbed('#ipc_box', IPC_Box);
		</script>
	</body>
</html>

